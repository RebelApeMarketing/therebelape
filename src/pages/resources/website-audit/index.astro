---
import Base from '../../../layouts/Base.astro';
import Hero from '../../../components/sections/Hero.astro';
import SocialProofBar from '../../../components/sections/SocialProofBar.astro';
import Button from '../../../components/ui/Button.astro';

// SEO
const title = "Free Website Audit for Contractors | Rebel Ape Marketing";
const description = "Get an honest, automated audit of your contractor website. We check the 20 things that actually matter for conversions — and tell you how to fix them. No sales pitch.";
const canonical = "https://therebelape.com/resources/website-audit/";
const image = "https://RebelApeCDN.b-cdn.net/resources-website-audit.webp";
const type = "website";
const robots = "index, follow";
---

<Base {title} {description} {canonical} {image} {type} {robots}>
  <section>
    <Hero
      backgroundImage="https://RebelApeCDN.b-cdn.net/bg-gorilla-direct.webp"
      title="Most 'Free Website Audits' Are <span class='text-rebel-green'>Bullshit</span>"
      subtitle="This One Actually Tells You What's Broken — And How to Fix It"
      description="They tell you your site is broken (shocking, right?) and then try to sell you a $15K rebuild. This tool actually checks the things that matter for contractor websites and gives you real answers — whether you hire us or not."
      features={[
        '20 Real Conversion Checks',
        'Honest Scoring System',
        'Actionable Fix List'
      ]}
      buttonText="Schedule Strategy Session"
      buttonIcon="calendar"
      buttonHref="/schedule/"
      fetchpriority="high"
    />
    <SocialProofBar />

    <!-- Main Content Area -->
    <section class="py-16 md:py-24 section-checkers">
      <div class="max-w-5xl mx-auto px-4">

        <!-- STEP 1: URL INPUT -->
        <div id="step-input" class="transition-opacity duration-500">
          <div class="text-center mb-12">
            <h2 class="text-4xl md:text-5xl font-black text-gray-900 mb-4">
              Enter Your Website URL
            </h2>
            <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto mb-2">
              We'll check the things that actually matter for contractor websites:
            </p>
          </div>

          <div class="max-w-3xl mx-auto">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8 text-gray-700">
              <ul class="space-y-3">
                <li class="flex gap-3">
                  <span class="text-[#32C55F] text-xl font-bold flex-shrink-0">&#10003;</span>
                  <span>Does your hero section make people want to call you?</span>
                </li>
                <li class="flex gap-3">
                  <span class="text-[#32C55F] text-xl font-bold flex-shrink-0">&#10003;</span>
                  <span>Is your positioning generic BS or does it differentiate you?</span>
                </li>
                <li class="flex gap-3">
                  <span class="text-[#32C55F] text-xl font-bold flex-shrink-0">&#10003;</span>
                  <span>Are your trust signals visible or buried?</span>
                </li>
              </ul>
              <ul class="space-y-3">
                <li class="flex gap-3">
                  <span class="text-[#32C55F] text-xl font-bold flex-shrink-0">&#10003;</span>
                  <span>Can people actually find your phone number on mobile?</span>
                </li>
                <li class="flex gap-3">
                  <span class="text-[#32C55F] text-xl font-bold flex-shrink-0">&#10003;</span>
                  <span>Is your site fast enough that impatient homeowners don't bounce?</span>
                </li>
                <li class="flex gap-3">
                  <span class="text-[#32C55F] text-xl font-bold flex-shrink-0">&#10003;</span>
                  <span>Are your calls-to-action clear or confusing?</span>
                </li>
              </ul>
            </div>

            <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
              <div class="h-2 bg-[#32C55F]"></div>
              <div class="p-8 md:p-12">
                <label for="website-url" class="block text-sm font-semibold text-gray-900 mb-3">
                  Your Website URL
                </label>
                <div class="flex flex-col sm:flex-row gap-4">
                  <input
                    type="url"
                    id="website-url"
                    placeholder="https://yourcompany.com"
                    class="flex-1 px-4 py-4 bg-white border-2 border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#32C55F] focus:border-transparent text-lg"
                    required
                  />
                  <button
                    id="start-scan-btn"
                    type="button"
                    class="bg-[#069c4b] hover:bg-[#057a3b] text-white font-bold py-4 px-8 rounded-lg text-lg transition duration-200 ease-in-out transform hover:scale-105 whitespace-nowrap"
                  >
                    Analyze My Site
                  </button>
                </div>
                <p class="text-sm text-gray-500 mt-3">Takes 15-20 seconds to scan. We'll ask a few quick questions while we analyze.</p>
                <p id="url-error" class="text-sm text-red-600 mt-2 hidden">Please enter a valid URL (e.g., https://yourcompany.com)</p>
              </div>
            </div>
          </div>
        </div>

        <!-- STEP 2: SCANNING + QUESTIONS -->
        <div id="step-scanning" class="hidden transition-opacity duration-500">
          <div class="bg-white rounded-2xl shadow-2xl overflow-hidden max-w-3xl mx-auto">
            <div class="h-2 bg-[#32C55F]"></div>
            <div class="p-8 md:p-12">

              <!-- Scan Progress -->
              <div class="mb-10">
                <div class="flex items-center justify-between mb-3">
                  <h3 class="text-xl font-bold text-gray-900">
                    Analyzing <span id="scan-domain" class="text-[#069c4b]"></span>...
                  </h3>
                  <span id="scan-percent" class="text-sm font-semibold text-gray-500">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                  <div id="scan-progress-bar" class="bg-[#32C55F] h-3 rounded-full transition-all duration-700 ease-out" style="width: 0%"></div>
                </div>

                <!-- Scan checklist -->
                <div class="mt-6 space-y-3" id="scan-checklist">
                  <div class="flex items-center gap-3 text-gray-500" data-check="speed">
                    <span class="scan-icon w-5 h-5 flex items-center justify-center">
                      <span class="w-2 h-2 rounded-full bg-gray-300"></span>
                    </span>
                    <span>Page speed &amp; mobile performance</span>
                  </div>
                  <div class="flex items-center gap-3 text-gray-500" data-check="conversion">
                    <span class="scan-icon w-5 h-5 flex items-center justify-center">
                      <span class="w-2 h-2 rounded-full bg-gray-300"></span>
                    </span>
                    <span>Conversion elements (CTAs, forms, phone numbers)</span>
                  </div>
                  <div class="flex items-center gap-3 text-gray-500" data-check="trust">
                    <span class="scan-icon w-5 h-5 flex items-center justify-center">
                      <span class="w-2 h-2 rounded-full bg-gray-300"></span>
                    </span>
                    <span>Trust signals &amp; social proof</span>
                  </div>
                  <div class="flex items-center gap-3 text-gray-500" data-check="technical">
                    <span class="scan-icon w-5 h-5 flex items-center justify-center">
                      <span class="w-2 h-2 rounded-full bg-gray-300"></span>
                    </span>
                    <span>Technical issues &amp; security</span>
                  </div>
                </div>
              </div>

              <!-- Divider -->
              <div class="border-t-2 border-slate-100 my-8"></div>

              <!-- Questions Area -->
              <div id="questions-area">
                <p class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-6">Quick Questions While We Scan</p>

                <!-- Question 1: Hero Promise -->
                <div class="question-card" data-question="1">
                  <h4 class="text-lg font-bold text-gray-900 mb-4">Does your hero section make a specific promise or is it generic?</h4>
                  <div class="space-y-3">
                    <label class="flex items-start gap-3 p-3 rounded-lg border-2 border-slate-200 hover:border-[#32C55F] cursor-pointer transition-colors question-option">
                      <input type="radio" name="q-hero" value="specific" class="mt-1 accent-[#069c4b]" />
                      <div>
                        <span class="font-semibold text-gray-900">Specific promise</span>
                        <span class="block text-sm text-gray-500">e.g., "Get your roof replaced in 3 days"</span>
                      </div>
                    </label>
                    <label class="flex items-start gap-3 p-3 rounded-lg border-2 border-slate-200 hover:border-[#32C55F] cursor-pointer transition-colors question-option">
                      <input type="radio" name="q-hero" value="generic" class="mt-1 accent-[#069c4b]" />
                      <div>
                        <span class="font-semibold text-gray-900">Generic</span>
                        <span class="block text-sm text-gray-500">e.g., "Quality roofing since 1987"</span>
                      </div>
                    </label>
                    <label class="flex items-start gap-3 p-3 rounded-lg border-2 border-slate-200 hover:border-[#32C55F] cursor-pointer transition-colors question-option">
                      <input type="radio" name="q-hero" value="unsure" class="mt-1 accent-[#069c4b]" />
                      <div><span class="font-semibold text-gray-900">Not sure what a hero section is</span></div>
                    </label>
                  </div>
                </div>

                <!-- Question 2: CTA Above Fold -->
                <div class="question-card hidden" data-question="2">
                  <h4 class="text-lg font-bold text-gray-900 mb-4">Is there a clear offer above the fold?</h4>
                  <div class="space-y-3">
                    <label class="flex items-start gap-3 p-3 rounded-lg border-2 border-slate-200 hover:border-[#32C55F] cursor-pointer transition-colors question-option">
                      <input type="radio" name="q-cta" value="yes" class="mt-1 accent-[#069c4b]" />
                      <div>
                        <span class="font-semibold text-gray-900">Yes</span>
                        <span class="block text-sm text-gray-500">Free estimate, inspection, consultation, etc.</span>
                      </div>
                    </label>
                    <label class="flex items-start gap-3 p-3 rounded-lg border-2 border-slate-200 hover:border-[#32C55F] cursor-pointer transition-colors question-option">
                      <input type="radio" name="q-cta" value="no" class="mt-1 accent-[#069c4b]" />
                      <div><span class="font-semibold text-gray-900">No or buried below the fold</span></div>
                    </label>
                    <label class="flex items-start gap-3 p-3 rounded-lg border-2 border-slate-200 hover:border-[#32C55F] cursor-pointer transition-colors question-option">
                      <input type="radio" name="q-cta" value="unsure" class="mt-1 accent-[#069c4b]" />
                      <div><span class="font-semibold text-gray-900">Not sure</span></div>
                    </label>
                  </div>
                </div>

                <!-- Question 3: Problem & Solution -->
                <div class="question-card hidden" data-question="3">
                  <h4 class="text-lg font-bold text-gray-900 mb-4">Does your website clearly explain the problem you solve and how you solve it?</h4>
                  <div class="space-y-3">
                    <label class="flex items-start gap-3 p-3 rounded-lg border-2 border-slate-200 hover:border-[#32C55F] cursor-pointer transition-colors question-option">
                      <input type="radio" name="q-problem" value="yes" class="mt-1 accent-[#069c4b]" />
                      <div>
                        <span class="font-semibold text-gray-900">Yes — we address specific problems and show our solution</span>
                        <span class="block text-sm text-gray-500">e.g., "Leaking roof? We'll have it fixed in 48 hours."</span>
                      </div>
                    </label>
                    <label class="flex items-start gap-3 p-3 rounded-lg border-2 border-slate-200 hover:border-[#32C55F] cursor-pointer transition-colors question-option">
                      <input type="radio" name="q-problem" value="partial" class="mt-1 accent-[#069c4b]" />
                      <div>
                        <span class="font-semibold text-gray-900">Somewhat — we list services but don't frame them around customer problems</span>
                      </div>
                    </label>
                    <label class="flex items-start gap-3 p-3 rounded-lg border-2 border-slate-200 hover:border-[#32C55F] cursor-pointer transition-colors question-option">
                      <input type="radio" name="q-problem" value="no" class="mt-1 accent-[#069c4b]" />
                      <div><span class="font-semibold text-gray-900">No — mostly generic language about who we are</span></div>
                    </label>
                  </div>
                </div>

                <!-- Question 4: Why Us / Differentiation -->
                <div class="question-card hidden" data-question="4">
                  <h4 class="text-lg font-bold text-gray-900 mb-4">Does your website differentiate why someone should choose you over competitors?</h4>
                  <div class="space-y-3">
                    <label class="flex items-start gap-3 p-3 rounded-lg border-2 border-slate-200 hover:border-[#32C55F] cursor-pointer transition-colors question-option">
                      <input type="radio" name="q-whyus" value="yes" class="mt-1 accent-[#069c4b]" />
                      <div>
                        <span class="font-semibold text-gray-900">Yes — clear, specific differentiators</span>
                        <span class="block text-sm text-gray-500">e.g., specific guarantees, unique process, proprietary method</span>
                      </div>
                    </label>
                    <label class="flex items-start gap-3 p-3 rounded-lg border-2 border-slate-200 hover:border-[#32C55F] cursor-pointer transition-colors question-option">
                      <input type="radio" name="q-whyus" value="generic" class="mt-1 accent-[#069c4b]" />
                      <div>
                        <span class="font-semibold text-gray-900">Generic — "quality," "experienced," "trusted"</span>
                        <span class="block text-sm text-gray-500">Every competitor says the same thing</span>
                      </div>
                    </label>
                    <label class="flex items-start gap-3 p-3 rounded-lg border-2 border-slate-200 hover:border-[#32C55F] cursor-pointer transition-colors question-option">
                      <input type="radio" name="q-whyus" value="none" class="mt-1 accent-[#069c4b]" />
                      <div><span class="font-semibold text-gray-900">No "Why Us" section at all</span></div>
                    </label>
                  </div>
                </div>

                <!-- Question 5: Branded Photos -->
                <div class="question-card hidden" data-question="5">
                  <h4 class="text-lg font-bold text-gray-900 mb-4">Do you have branded photos of your team or trucks?</h4>
                  <div class="space-y-3">
                    <label class="flex items-start gap-3 p-3 rounded-lg border-2 border-slate-200 hover:border-[#32C55F] cursor-pointer transition-colors question-option">
                      <input type="radio" name="q-photos" value="yes" class="mt-1 accent-[#069c4b]" />
                      <div><span class="font-semibold text-gray-900">Yes, throughout the site</span></div>
                    </label>
                    <label class="flex items-start gap-3 p-3 rounded-lg border-2 border-slate-200 hover:border-[#32C55F] cursor-pointer transition-colors question-option">
                      <input type="radio" name="q-photos" value="some" class="mt-1 accent-[#069c4b]" />
                      <div><span class="font-semibold text-gray-900">Some, but not prominent</span></div>
                    </label>
                    <label class="flex items-start gap-3 p-3 rounded-lg border-2 border-slate-200 hover:border-[#32C55F] cursor-pointer transition-colors question-option">
                      <input type="radio" name="q-photos" value="no" class="mt-1 accent-[#069c4b]" />
                      <div><span class="font-semibold text-gray-900">No, mostly stock photos or generic images</span></div>
                    </label>
                  </div>
                </div>

                <!-- Question 6: Running Ads (informational, not scored) -->
                <div class="question-card hidden" data-question="6">
                  <h4 class="text-lg font-bold text-gray-900 mb-4">Are you currently running paid ads to this website?</h4>
                  <p class="text-sm text-gray-500 mb-4">This helps us understand your situation — it doesn't affect your score.</p>
                  <div class="space-y-3">
                    <label class="flex items-start gap-3 p-3 rounded-lg border-2 border-slate-200 hover:border-[#32C55F] cursor-pointer transition-colors question-option">
                      <input type="radio" name="q-ads" value="yes" class="mt-1 accent-[#069c4b]" />
                      <div><span class="font-semibold text-gray-900">Yes</span></div>
                    </label>
                    <label class="flex items-start gap-3 p-3 rounded-lg border-2 border-slate-200 hover:border-[#32C55F] cursor-pointer transition-colors question-option">
                      <input type="radio" name="q-ads" value="no" class="mt-1 accent-[#069c4b]" />
                      <div><span class="font-semibold text-gray-900">No</span></div>
                    </label>
                    <label class="flex items-start gap-3 p-3 rounded-lg border-2 border-slate-200 hover:border-[#32C55F] cursor-pointer transition-colors question-option">
                      <input type="radio" name="q-ads" value="unsure" class="mt-1 accent-[#069c4b]" />
                      <div><span class="font-semibold text-gray-900">Not sure</span></div>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- STEP 3: RESULTS -->
        <div id="step-results" class="hidden transition-opacity duration-500">
          <div class="text-center mb-10">
            <h2 class="text-4xl md:text-5xl font-black text-gray-900 mb-3">
              Here's the Truth About Your Website
            </h2>
            <p class="text-lg text-gray-500" id="results-domain"></p>
          </div>

          <!-- Score Display -->
          <div class="max-w-md mx-auto mb-12">
            <div class="bg-white rounded-2xl shadow-2xl p-8 text-center">
              <div class="relative w-48 h-48 mx-auto mb-6">
                <svg class="w-48 h-48 transform -rotate-90" viewBox="0 0 120 120">
                  <circle cx="60" cy="60" r="52" fill="none" stroke="#e5e7eb" stroke-width="10" />
                  <circle id="score-circle" cx="60" cy="60" r="52" fill="none" stroke="#069c4b" stroke-width="10" stroke-linecap="round" stroke-dasharray="326.73" stroke-dashoffset="326.73" class="transition-all duration-[2000ms] ease-out" />
                </svg>
                <div class="absolute inset-0 flex items-center justify-center">
                  <div>
                    <span id="score-number" class="text-5xl font-black text-gray-900">0</span>
                    <span class="text-2xl font-bold text-gray-400">/100</span>
                  </div>
                </div>
              </div>
              <p id="score-grade" class="text-lg font-bold text-gray-700"></p>
            </div>
          </div>

          <!-- Top Issues -->
          <div id="top-issues-section" class="max-w-3xl mx-auto mb-12 hidden">
            <h3 class="text-2xl font-bold text-gray-900 mb-6">Your Biggest Problems</h3>
            <div id="top-issues-list" class="space-y-4"></div>
          </div>

          <!-- Full Breakdown -->
          <div class="max-w-3xl mx-auto mb-12">
            <h3 class="text-2xl font-bold text-gray-900 mb-6">Full Breakdown</h3>

            <!-- Technical Foundation -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-6">
              <div class="flex items-center justify-between p-5 bg-slate-50 border-b border-slate-200">
                <h4 class="text-lg font-bold text-gray-900">Technical Foundation</h4>
                <span id="cat-technical" class="text-lg font-bold text-[#069c4b]">0/25</span>
              </div>
              <div id="checks-technical" class="p-5 space-y-3"></div>
            </div>

            <!-- Conversion Elements -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-6">
              <div class="flex items-center justify-between p-5 bg-slate-50 border-b border-slate-200">
                <h4 class="text-lg font-bold text-gray-900">Conversion Elements</h4>
                <span id="cat-conversion" class="text-lg font-bold text-[#069c4b]">0/25</span>
              </div>
              <div id="checks-conversion" class="p-5 space-y-3"></div>
            </div>

            <!-- Content & Messaging -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-6">
              <div class="flex items-center justify-between p-5 bg-slate-50 border-b border-slate-200">
                <h4 class="text-lg font-bold text-gray-900">Content &amp; Messaging</h4>
                <span id="cat-content" class="text-lg font-bold text-[#069c4b]">0/25</span>
              </div>
              <div id="checks-content" class="p-5 space-y-3"></div>
            </div>

            <!-- Trust & Proof -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-6">
              <div class="flex items-center justify-between p-5 bg-slate-50 border-b border-slate-200">
                <h4 class="text-lg font-bold text-gray-900">Trust &amp; Proof</h4>
                <span id="cat-trust" class="text-lg font-bold text-[#069c4b]">0/25</span>
              </div>
              <div id="checks-trust" class="p-5 space-y-3"></div>
            </div>
          </div>

          <!-- Email Gate -->
          <div class="max-w-2xl mx-auto">
            <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
              <div class="h-2 bg-[#32C55F]"></div>
              <div class="p-8 md:p-10">
                <h3 class="text-2xl font-bold text-gray-900 mb-2 text-center">Want the Full Report With Action Steps?</h3>
                <p class="text-gray-600 mb-6 text-center">
                  Enter your email and we'll send you the detailed analysis with prioritized fix list and examples of what "good" looks like.
                </p>

                <form id="lead-form" name="website-audit" method="POST" data-netlify="true" netlify-honeypot="bot-field">
                  <input type="hidden" name="bot-field" />
                  <input type="hidden" name="form-name" value="website-audit" />
                  <input type="hidden" name="subject" id="hidden-subject" value="Website Audit Lead" />
                  <input type="hidden" name="audit-url" id="hidden-audit-url" />
                  <input type="hidden" name="audit-score" id="hidden-audit-score" />
                  <input type="hidden" name="audit-grade" id="hidden-audit-grade" />

                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                      <label for="lead-name" class="block text-sm font-semibold text-gray-900 mb-2">
                        Name <span class="text-red-600">*</span>
                      </label>
                      <input
                        type="text"
                        id="lead-name"
                        name="name"
                        required
                        class="w-full px-4 py-3 bg-white border-2 border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#32C55F] focus:border-transparent text-lg"
                        placeholder="John Smith"
                      />
                    </div>
                    <div>
                      <label for="lead-email" class="block text-sm font-semibold text-gray-900 mb-2">
                        Email <span class="text-red-600">*</span>
                      </label>
                      <input
                        type="email"
                        id="lead-email"
                        name="email"
                        required
                        class="w-full px-4 py-3 bg-white border-2 border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#32C55F] focus:border-transparent text-lg"
                        placeholder="john@company.com"
                      />
                    </div>
                  </div>
                  <div class="mb-6">
                    <label for="lead-phone" class="block text-sm font-semibold text-gray-900 mb-2">
                      Phone <span class="text-gray-400 font-normal">(optional)</span>
                    </label>
                    <input
                      type="tel"
                      id="lead-phone"
                      name="phone"
                      class="w-full px-4 py-3 bg-white border-2 border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#32C55F] focus:border-transparent text-lg"
                      placeholder="(555) 123-4567"
                    />
                  </div>
                  <div class="text-center">
                    <button
                      type="submit"
                      id="lead-submit-btn"
                      class="bg-yellow-400 hover:bg-yellow-500 text-slate-900 font-bold py-4 px-8 rounded-lg text-lg transition duration-200 ease-in-out transform hover:scale-105 inline-flex items-center gap-2 w-full sm:w-auto justify-center"
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                        <path d="M1.5 8.67v8.58a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V8.67l-8.928 5.493a3 3 0 0 1-3.144 0L1.5 8.67Z" />
                        <path d="M22.5 6.908V6.75a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3v.158l9.714 5.978a1.5 1.5 0 0 0 1.572 0L22.5 6.908Z" />
                      </svg>
                      Send Me The Full Report
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <!-- Scan Another -->
          <div class="text-center mt-8">
            <button id="scan-another-btn" type="button" class="text-[#069c4b] hover:text-[#057a3b] font-semibold underline underline-offset-4">
              Scan Another Website
            </button>
          </div>
        </div>

      </div>
    </section>

    <!-- Why This Tool Section -->
    <section class="py-16 md:py-24 section-slate">
      <div class="max-w-7xl mx-auto px-4">
        <div class="max-w-4xl mx-auto">
          <h2 class="text-3xl md:text-4xl font-bold mb-6 text-center">Why We Built This Tool</h2>
          <div class="prose prose-lg max-w-none text-gray-700">
            <p class="mb-4">
              We got tired of seeing contractors get burned by "free audits" that are nothing more than a sales pitch in disguise. They tell you everything is broken (it probably isn't), then quote you $15K to rebuild your entire site.
            </p>
            <p class="mb-4">
              This tool checks the things that actually matter for contractor websites. Not vanity metrics. Not theoretical SEO scores. The stuff that determines whether a homeowner picks up the phone or bounces to your competitor.
            </p>
            <p class="mb-4">
              We'll tell you what's actually broken and how to fix it — whether you hire us or not. If your site really is killing your conversions, yeah, we'll offer to help. But you'll know exactly WHY it's not working, not just get a sales pitch.
            </p>
            <p>
              Most contractors can fix 3-4 of the issues themselves in a weekend. The rest is where a team like ours comes in.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- CTA Section -->
    <section class="py-16 md:py-24 bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900">
      <div class="max-w-4xl mx-auto px-4 text-center">
        <h2 class="text-4xl md:text-5xl font-black text-white mb-6">
          Want Help Actually Fixing This Stuff?
        </h2>
        <p class="text-lg md:text-xl text-slate-200 mb-8 max-w-2xl mx-auto">
          We build complete lead generation systems for contractors who are tired of websites that don't convert. Schedule a free strategy call and let's talk about your specific situation.
        </p>
        <div class="flex justify-center">
          <Button text="Schedule a Strategy Call" icon="calendar" href="/schedule/" />
        </div>
      </div>
    </section>

  </section>
</Base>

<style>
  .question-option:has(input:checked) {
    border-color: #32C55F;
    background-color: #f0fdf4;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  .animate-spin-slow {
    animation: spin 1s linear infinite;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // --- STATE ---
    let scanResults: any = null;
    let questionAnswers: Record<string, string> = {};
    let currentQuestion = 1;
    const totalQuestions = 6;

    // --- DOM REFS ---
    const stepInput = document.getElementById('step-input') as HTMLDivElement;
    const stepScanning = document.getElementById('step-scanning') as HTMLDivElement;
    const stepResults = document.getElementById('step-results') as HTMLDivElement;
    const urlInput = document.getElementById('website-url') as HTMLInputElement;
    const startBtn = document.getElementById('start-scan-btn') as HTMLButtonElement;
    const urlError = document.getElementById('url-error') as HTMLParagraphElement;
    const scanDomain = document.getElementById('scan-domain') as HTMLSpanElement;
    const scanPercent = document.getElementById('scan-percent') as HTMLSpanElement;
    const scanProgressBar = document.getElementById('scan-progress-bar') as HTMLDivElement;
    const leadForm = document.getElementById('lead-form') as HTMLFormElement;
    const scanAnotherBtn = document.getElementById('scan-another-btn') as HTMLButtonElement;
    const phoneInput = document.getElementById('lead-phone') as HTMLInputElement;

    // --- URL VALIDATION ---
    function isValidUrl(str: string): boolean {
      let url = str.trim();
      if (!url.startsWith('http://') && !url.startsWith('https://')) {
        url = 'https://' + url;
      }
      try {
        const parsed = new URL(url);
        return parsed.hostname.includes('.');
      } catch {
        return false;
      }
    }

    function normalizeUrl(str: string): string {
      let url = str.trim();
      if (!url.startsWith('http://') && !url.startsWith('https://')) {
        url = 'https://' + url;
      }
      return url;
    }

    // --- PHONE FORMATTING ---
    phoneInput.addEventListener('input', () => {
      let digits = phoneInput.value.replace(/[^0-9]/g, '');
      if (digits.length > 10 && digits.startsWith('1')) digits = digits.substring(1);
      digits = digits.substring(0, 10);
      if (digits.length === 0) phoneInput.value = '';
      else if (digits.length <= 3) phoneInput.value = `(${digits}`;
      else if (digits.length <= 6) phoneInput.value = `(${digits.substring(0, 3)}) ${digits.substring(3)}`;
      else phoneInput.value = `(${digits.substring(0, 3)}) ${digits.substring(3, 6)}-${digits.substring(6)}`;
    });

    // --- STEP TRANSITIONS ---
    function showStep(step: 'input' | 'scanning' | 'results') {
      [stepInput, stepScanning, stepResults].forEach(el => {
        el.classList.add('hidden');
        el.style.opacity = '0';
      });
      const target = step === 'input' ? stepInput : step === 'scanning' ? stepScanning : stepResults;
      target.classList.remove('hidden');
      // Scroll to top of content
      target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      setTimeout(() => { target.style.opacity = '1'; }, 50);
    }

    // --- SCAN CHECKLIST ANIMATION ---
    function updateChecklistItem(name: string, status: 'pending' | 'active' | 'done') {
      const item = document.querySelector(`[data-check="${name}"]`) as HTMLDivElement;
      if (!item) return;
      const iconSpan = item.querySelector('.scan-icon') as HTMLSpanElement;
      if (status === 'active') {
        item.classList.remove('text-gray-500');
        item.classList.add('text-gray-900', 'font-semibold');
        iconSpan.innerHTML = '<svg class="w-5 h-5 text-[#069c4b] animate-spin-slow" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg>';
      } else if (status === 'done') {
        item.classList.remove('text-gray-500');
        item.classList.add('text-[#069c4b]', 'font-semibold');
        iconSpan.innerHTML = '<svg class="w-5 h-5 text-[#069c4b]" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>';
      }
    }

    // --- QUESTION FLOW ---
    function showQuestion(num: number) {
      document.querySelectorAll('.question-card').forEach(card => {
        (card as HTMLElement).classList.add('hidden');
      });
      const card = document.querySelector(`[data-question="${num}"]`) as HTMLDivElement;
      if (card) {
        card.classList.remove('hidden');
        card.style.opacity = '0';
        setTimeout(() => { card.style.opacity = '1'; }, 50);
        card.style.transition = 'opacity 0.4s ease';
      }
    }

    // Track readiness for results
    let scanComplete = false;
    let questionsComplete = false;

    function checkIfReady() {
      if (scanComplete && questionsComplete) {
        renderResults();
      }
    }

    // Auto-advance when an answer is selected
    document.querySelectorAll('.question-option input[type="radio"]').forEach(radio => {
      radio.addEventListener('change', (e) => {
        const input = e.target as HTMLInputElement;
        const name = input.name;
        const value = input.value;

        // Store answer
        if (name === 'q-hero') questionAnswers.heroPromise = value;
        else if (name === 'q-cta') questionAnswers.ctaAboveFold = value;
        else if (name === 'q-problem') questionAnswers.problemSolution = value;
        else if (name === 'q-whyus') questionAnswers.whyUs = value;
        else if (name === 'q-photos') questionAnswers.brandedPhotos = value;
        else if (name === 'q-ads') questionAnswers.runningAds = value;

        // Visual feedback then advance
        setTimeout(() => {
          currentQuestion++;
          if (currentQuestion <= totalQuestions) {
            showQuestion(currentQuestion);
          } else {
            // All questions answered — hide question area, show waiting message if scan isn't done
            questionsComplete = true;
            const questionsArea = document.getElementById('questions-area') as HTMLDivElement;
            if (scanComplete) {
              checkIfReady();
            } else {
              questionsArea.innerHTML = '<div class="text-center py-6"><p class="text-lg font-semibold text-gray-700">Thanks! Finishing up the scan...</p></div>';
            }
          }
        }, 400);
      });
    });

    // --- SCANNING PROGRESS SIMULATION ---
    function simulateScanProgress(callback: () => void) {
      let progress = 0;
      const steps = [
        { at: 10, check: 'speed', status: 'active' as const },
        { at: 30, check: 'speed', status: 'done' as const },
        { at: 30, check: 'conversion', status: 'active' as const },
        { at: 55, check: 'conversion', status: 'done' as const },
        { at: 55, check: 'trust', status: 'active' as const },
        { at: 75, check: 'trust', status: 'done' as const },
        { at: 75, check: 'technical', status: 'active' as const },
        { at: 95, check: 'technical', status: 'done' as const },
      ];

      // Show first question immediately
      showQuestion(1);

      const interval = setInterval(() => {
        progress += 1;
        if (progress > 100) progress = 100;

        scanProgressBar.style.width = progress + '%';
        scanPercent.textContent = progress + '%';

        // Trigger checklist steps only — questions advance on user answer
        steps.forEach(step => {
          if (progress === step.at) {
            updateChecklistItem(step.check, step.status);
          }
        });

        if (progress >= 100) {
          clearInterval(interval);
          callback();
        }
      }, 200); // 20 seconds total (100 steps * 200ms)
    }

    // --- SCORING LOGIC FOR QUESTIONS ---
    function calculateQuestionScores() {
      let contentScore = 0;  // Content & Messaging (25 pts from questions)
      let trustQuestionScore = 0;  // Trust additions (10 pts from questions)

      // Content & Messaging (5 checks, 5 pts each = 25 pts)

      // Hero promise (5 pts)
      if (questionAnswers.heroPromise === 'specific') contentScore += 5;
      else if (questionAnswers.heroPromise === 'generic') contentScore += 2;

      // CTA above fold (5 pts)
      if (questionAnswers.ctaAboveFold === 'yes') contentScore += 5;
      else if (questionAnswers.ctaAboveFold === 'unsure') contentScore += 2;

      // Problem & Solution (5 pts)
      if (questionAnswers.problemSolution === 'yes') contentScore += 5;
      else if (questionAnswers.problemSolution === 'partial') contentScore += 2;

      // Why Us / Differentiation (5 pts)
      if (questionAnswers.whyUs === 'yes') contentScore += 5;
      else if (questionAnswers.whyUs === 'generic') contentScore += 2;

      // Branded photos (5 pts) — goes to content since it's about site content quality
      if (questionAnswers.brandedPhotos === 'yes') contentScore += 5;
      else if (questionAnswers.brandedPhotos === 'some') contentScore += 2;

      return { contentScore, trustQuestionScore };
    }

    // --- RENDER RESULTS ---
    function renderResults() {
      if (!scanResults) return;

      const { contentScore, trustQuestionScore } = calculateQuestionScores();

      // Adjust scores
      scanResults.scores.content = contentScore;
      scanResults.scores.trust += trustQuestionScore;

      // Recalculate total
      scanResults.totalScore = scanResults.scores.technical + scanResults.scores.conversion + scanResults.scores.content + scanResults.scores.trust;

      // Cap at 100
      if (scanResults.totalScore > 100) scanResults.totalScore = 100;

      const score = scanResults.totalScore;

      // Grade
      let grade = '';
      let gradeMessage = '';
      let gradeColor = '';
      if (score >= 80) {
        grade = 'A'; gradeMessage = 'Your website is solid'; gradeColor = '#069c4b';
      } else if (score >= 60) {
        grade = 'B'; gradeMessage = 'Your website works but leaves money on the table'; gradeColor = '#f59e0b';
      } else if (score >= 40) {
        grade = 'C'; gradeMessage = 'Your website is hurting your business'; gradeColor = '#ef4444';
      } else {
        grade = 'D'; gradeMessage = 'Your website is actively losing you jobs'; gradeColor = '#991b1b';
      }

      scanResults.grade = grade;
      scanResults.gradeMessage = gradeMessage;

      // Update score circle
      const circle = document.getElementById('score-circle') as SVGCircleElement;
      const circumference = 326.73;
      const offset = circumference - (score / 100) * circumference;
      circle.style.stroke = gradeColor;
      setTimeout(() => {
        circle.style.strokeDashoffset = String(offset);
      }, 100);

      // Animate number
      const scoreNum = document.getElementById('score-number') as HTMLSpanElement;
      let current = 0;
      const numInterval = setInterval(() => {
        current++;
        if (current > score) { clearInterval(numInterval); return; }
        scoreNum.textContent = String(current);
      }, 20);

      // Grade text
      (document.getElementById('score-grade') as HTMLParagraphElement).textContent = gradeMessage;
      (document.getElementById('score-grade') as HTMLParagraphElement).style.color = gradeColor;

      // Domain
      (document.getElementById('results-domain') as HTMLParagraphElement).textContent = scanResults.hostname;

      // Top issues
      const topIssues = scanResults.topIssues || [];
      if (topIssues.length > 0) {
        const issuesSection = document.getElementById('top-issues-section') as HTMLDivElement;
        const issuesList = document.getElementById('top-issues-list') as HTMLDivElement;
        issuesSection.classList.remove('hidden');

        issuesList.innerHTML = topIssues.slice(0, 3).map((issue: any, i: number) => `
          <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg">
            <div class="flex items-start gap-3">
              <span class="text-red-600 font-black text-lg">${i + 1}.</span>
              <div>
                <p class="font-bold text-gray-900">${issue.name}</p>
                <p class="text-gray-600 text-sm mt-1">${issue.details}</p>
              </div>
            </div>
          </div>
        `).join('');
      }

      // Category scores
      (document.getElementById('cat-technical') as HTMLSpanElement).textContent = `${scanResults.scores.technical}/25`;
      (document.getElementById('cat-conversion') as HTMLSpanElement).textContent = `${scanResults.scores.conversion}/25`;
      (document.getElementById('cat-content') as HTMLSpanElement).textContent = `${scanResults.scores.content}/25`;
      (document.getElementById('cat-trust') as HTMLSpanElement).textContent = `${scanResults.scores.trust}/25`;

      // Render individual checks — Technical
      renderCheckGroup('checks-technical', [
        { key: 'mobileResponsive', label: 'Mobile Responsive' },
        { key: 'pageSpeed', label: 'Page Speed' },
        { key: 'ssl', label: 'SSL Certificate' },
        { key: 'brokenLinks', label: 'Broken Links' },
        { key: 'faqSection', label: 'FAQ Section' }
      ]);

      // Conversion
      renderCheckGroup('checks-conversion', [
        { key: 'phoneVisible', label: 'Phone Number Visible' },
        { key: 'clickToCall', label: 'Click-to-Call on Mobile' },
        { key: 'contactForm', label: 'Contact Form / Contact Page' },
        { key: 'clearCTAs', label: 'Clear CTAs' },
        { key: 'servicesCatalog', label: 'Services Catalog' }
      ]);

      // Content & Messaging (all from questions)
      const contentContainer = document.getElementById('checks-content') as HTMLDivElement;
      contentContainer.innerHTML = '';
      renderQuestionCheck(contentContainer, 'Hero Promise', questionAnswers.heroPromise, 5, { specific: 5, generic: 2, unsure: 0 });
      renderQuestionCheck(contentContainer, 'CTA Above Fold', questionAnswers.ctaAboveFold, 5, { yes: 5, unsure: 2, no: 0 });
      renderQuestionCheck(contentContainer, 'Problem & Solution', questionAnswers.problemSolution, 5, { yes: 5, partial: 2, no: 0 });
      renderQuestionCheck(contentContainer, 'Why Us / Differentiation', questionAnswers.whyUs, 5, { yes: 5, generic: 2, none: 0 });
      renderQuestionCheck(contentContainer, 'Branded Photos', questionAnswers.brandedPhotos, 5, { yes: 5, some: 2, no: 0 });

      // Trust & Proof (all auto-scan)
      renderCheckGroup('checks-trust', [
        { key: 'testimonials', label: 'Testimonials / Reviews' },
        { key: 'resultsOutcomes', label: 'Results / Outcomes' },
        { key: 'credentials', label: 'Credentials Visible' },
        { key: 'aboutPage', label: 'About / Team Page' },
        { key: 'googleBusiness', label: 'Google Business Profile' }
      ]);

      // Set hidden form fields
      (document.getElementById('hidden-audit-url') as HTMLInputElement).value = scanResults.url;
      (document.getElementById('hidden-audit-score') as HTMLInputElement).value = String(score);
      (document.getElementById('hidden-audit-grade') as HTMLInputElement).value = gradeMessage;

      // Show results
      showStep('results');
    }

    function renderCheckGroup(containerId: string, checks: { key: string; label: string }[]) {
      const container = document.getElementById(containerId) as HTMLDivElement;
      if (!container) return;

      checks.forEach(check => {
        const data = scanResults.checks[check.key];
        if (!data) return;

        const passed = data.passed;
        const partial = data.score > 0 && !passed;
        const icon = passed ? '&#10003;' : (partial ? '&#9888;' : '&#10007;');
        const colorClass = passed ? 'text-green-600' : (partial ? 'text-yellow-600' : 'text-red-600');
        const bgClass = passed ? 'bg-green-50' : (partial ? 'bg-yellow-50' : 'bg-red-50');

        const el = document.createElement('div');
        el.className = `flex items-start gap-3 p-3 rounded-lg ${bgClass}`;
        el.innerHTML = `
          <span class="${colorClass} font-bold text-lg flex-shrink-0 mt-0.5">${icon}</span>
          <div class="flex-1">
            <div class="flex items-center justify-between">
              <span class="font-semibold text-gray-900">${check.label}</span>
              <span class="text-sm font-semibold ${colorClass}">${data.score}/${data.maxScore}</span>
            </div>
            <p class="text-sm text-gray-600 mt-1">${data.details}</p>
            ${data.performanceScore !== undefined && data.performanceScore !== null ? `<p class="text-xs text-gray-500 mt-1">Google PageSpeed: ${data.performanceScore}/100 | LCP: ${data.lcp} | CLS: ${data.cls}</p>` : ''}
          </div>
        `;
        container.appendChild(el);
      });
    }

    function renderQuestionCheck(container: HTMLDivElement, label: string, answer: string | undefined, maxScore: number, scoreMap: Record<string, number>) {
      const pts = answer ? (scoreMap[answer] || 0) : 0;
      const passed = pts === maxScore;
      const partial = pts > 0 && !passed;
      const icon = passed ? '&#10003;' : (partial ? '&#9888;' : '&#10007;');
      const colorClass = passed ? 'text-green-600' : (partial ? 'text-yellow-600' : 'text-red-600');
      const bgClass = passed ? 'bg-green-50' : (partial ? 'bg-yellow-50' : 'bg-red-50');

      const answerLabels: Record<string, string> = {
        specific: 'Specific — great',
        generic: 'Generic — needs improvement',
        yes: 'Yes',
        no: 'No — this is a problem',
        some: 'Some — could be better',
        unsure: 'Not sure — worth checking'
      };

      const el = document.createElement('div');
      el.className = `flex items-start gap-3 p-3 rounded-lg ${bgClass}`;
      el.innerHTML = `
        <span class="${colorClass} font-bold text-lg flex-shrink-0 mt-0.5">${icon}</span>
        <div class="flex-1">
          <div class="flex items-center justify-between">
            <span class="font-semibold text-gray-900">${label}</span>
            <span class="text-sm font-semibold ${colorClass}">${pts}/${maxScore}</span>
          </div>
          <p class="text-sm text-gray-600 mt-1">${answer ? (answerLabels[answer] || answer) : 'Not answered'}</p>
        </div>
      `;
      container.appendChild(el);
    }

    // --- START SCAN ---
    startBtn.addEventListener('click', async () => {
      const rawUrl = urlInput.value.trim();

      if (!rawUrl || !isValidUrl(rawUrl)) {
        urlError.classList.remove('hidden');
        urlInput.focus();
        return;
      }
      urlError.classList.add('hidden');

      const url = normalizeUrl(rawUrl);

      // Extract domain for display
      try {
        const parsed = new URL(url);
        scanDomain.textContent = parsed.hostname;
      } catch {
        scanDomain.textContent = rawUrl;
      }

      // Reset state
      currentQuestion = 1;
      questionAnswers = {};
      scanResults = null;
      document.querySelectorAll('.question-option input[type="radio"]').forEach(r => {
        (r as HTMLInputElement).checked = false;
      });
      document.querySelectorAll('.question-option').forEach(opt => {
        (opt as HTMLElement).closest('.question-option')?.classList.remove('border-[#32C55F]', 'bg-green-50');
      });

      // Reset scan checklist
      ['speed', 'conversion', 'trust', 'technical'].forEach(name => {
        const item = document.querySelector(`[data-check="${name}"]`) as HTMLDivElement;
        if (item) {
          item.classList.remove('text-gray-900', 'font-semibold', 'text-[#069c4b]');
          item.classList.add('text-gray-500');
          const iconSpan = item.querySelector('.scan-icon') as HTMLSpanElement;
          iconSpan.innerHTML = '<span class="w-2 h-2 rounded-full bg-gray-300"></span>';
        }
      });

      // Reset progress
      scanProgressBar.style.width = '0%';
      scanPercent.textContent = '0%';

      // Reset results DOM
      (document.getElementById('score-circle') as SVGCircleElement).style.strokeDashoffset = '326.73';
      (document.getElementById('score-number') as HTMLSpanElement).textContent = '0';
      (document.getElementById('top-issues-list') as HTMLDivElement).innerHTML = '';
      (document.getElementById('top-issues-section') as HTMLDivElement).classList.add('hidden');
      ['checks-technical', 'checks-conversion', 'checks-content', 'checks-trust'].forEach(id => {
        (document.getElementById(id) as HTMLDivElement).innerHTML = '';
      });

      // Show scanning step
      showStep('scanning');

      // Reset completion flags
      scanComplete = false;
      questionsComplete = false;

      const scanPromise = fetch('/.netlify/functions/website-audit-scan', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url })
      })
        .then(res => res.json())
        .then(data => {
          if (data.error) {
            throw new Error(data.error);
          }
          scanResults = data;
          scanComplete = true;
          checkIfReady();
        })
        .catch(err => {
          console.error('Scan failed:', err);
          // Create minimal results so we can still show something
          scanResults = {
            url,
            hostname: new URL(url).hostname,
            checks: {
              mobileResponsive: { score: 0, maxScore: 5, passed: false, details: 'Could not scan — site may be blocking automated requests' },
              pageSpeed: { score: 0, maxScore: 5, passed: false, details: 'Could not retrieve PageSpeed data' },
              ssl: { score: url.startsWith('https') ? 5 : 0, maxScore: 5, passed: url.startsWith('https'), details: url.startsWith('https') ? 'HTTPS detected' : 'Not using HTTPS' },
              brokenLinks: { score: 0, maxScore: 5, passed: false, details: 'Could not fully scan links' },
              faqSection: { score: 0, maxScore: 5, passed: false, details: 'Could not scan page content' },
              phoneVisible: { score: 0, maxScore: 5, passed: false, details: 'Could not scan page content' },
              clickToCall: { score: 0, maxScore: 5, passed: false, details: 'Could not scan page content' },
              contactForm: { score: 0, maxScore: 5, passed: false, details: 'Could not scan page content' },
              clearCTAs: { score: 0, maxScore: 5, passed: false, details: 'Could not scan page content' },
              servicesCatalog: { score: 0, maxScore: 5, passed: false, details: 'Could not scan page content' },
              testimonials: { score: 0, maxScore: 5, passed: false, details: 'Could not scan page content' },
              resultsOutcomes: { score: 0, maxScore: 5, passed: false, details: 'Could not scan page content' },
              credentials: { score: 0, maxScore: 5, passed: false, details: 'Could not scan page content' },
              aboutPage: { score: 0, maxScore: 5, passed: false, details: 'Could not scan page content' },
              googleBusiness: { score: 0, maxScore: 5, passed: false, details: 'Could not scan page content' }
            },
            scores: { technical: url.startsWith('https') ? 5 : 0, conversion: 0, content: 0, trust: 0 },
            totalScore: 0,
            topIssues: [{ name: 'Scan Blocked', details: 'We couldn\'t fully scan your site. This might mean you have security measures in place (good!) but we can only give you partial results.', category: 'Technical' }]
          };
          scanComplete = true;
          checkIfReady();
        });

      simulateScanProgress(() => {
        // Progress bar done — scan API may still be running, that's fine.
        // Results only show when both scan + questions are complete.
      });
    });

    // --- FORM SUBMISSION ---
    leadForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const submitBtn = document.getElementById('lead-submit-btn') as HTMLButtonElement;
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<svg class="animate-spin h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg> Sending...';

      const name = (document.getElementById('lead-name') as HTMLInputElement).value;
      const email = (document.getElementById('lead-email') as HTMLInputElement).value;
      const phone = (document.getElementById('lead-phone') as HTMLInputElement).value;

      // Set subject for Netlify dashboard
      (document.getElementById('hidden-subject') as HTMLInputElement).value = `${name} — ${scanResults?.totalScore || 0}/100`;

      try {
        // Submit to Netlify Forms
        const formData = new FormData(leadForm);
        await fetch('/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams(formData as any).toString()
        });

        // Submit to our function for emails + Make webhook
        await fetch('/.netlify/functions/website-audit-submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name,
            email,
            phone,
            website: scanResults?.url || '',
            score: scanResults?.totalScore || 0,
            grade: scanResults?.grade || '',
            gradeMessage: scanResults?.gradeMessage || '',
            topIssues: scanResults?.topIssues || [],
            checks: scanResults?.checks || {},
            scores: scanResults?.scores || {},
            questionAnswers
          })
        });

        // Redirect to thank you page
        window.location.href = '/resources/website-audit/thank-you/';

      } catch (error) {
        console.error('Submit error:', error);
        alert('Something went wrong. Please try again.');
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6"><path d="M1.5 8.67v8.58a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V8.67l-8.928 5.493a3 3 0 0 1-3.144 0L1.5 8.67Z" /><path d="M22.5 6.908V6.75a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3v.158l9.714 5.978a1.5 1.5 0 0 0 1.572 0L22.5 6.908Z" /></svg> Send Me The Full Report';
      }
    });

    // --- SCAN ANOTHER ---
    scanAnotherBtn.addEventListener('click', () => {
      urlInput.value = '';
      scanResults = null;
      questionAnswers = {};
      currentQuestion = 1;
      showStep('input');
    });

    // Enter key on URL input triggers scan
    urlInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        startBtn.click();
      }
    });
  });
</script>
