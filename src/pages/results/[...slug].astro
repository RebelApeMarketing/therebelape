---
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';
import ResultsLayout from '../../layouts/ResultsLayout.astro';

export const getStaticPaths = (async () => {
  const results = await getCollection('results');
  const publishedResults = results
    .filter(study => !study.data.draft)
    .sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime());

  return publishedResults.map((study, index) => {
    // Get the next result (wrap around to first if at the end)
    const nextIndex = (index + 1) % publishedResults.length;
    const nextResult = publishedResults[nextIndex];

    return {
      params: { slug: study.slug },
      props: {
        study,
        nextResult: {
          slug: nextResult.slug,
          clientType: nextResult.data.clientType
        }
      },
    };
  });
}) satisfies GetStaticPaths;

const { study, nextResult } = Astro.props;
const { Content } = await study.render();
---

<ResultsLayout
  title={study.data.title}
  headline={study.data.headline}
  clientType={study.data.clientType}
  industry={study.data.industry}
  description={study.data.description}
  image={study.data.image}
  slug={study.slug}
  results={study.data.results}
  timeline={study.data.timeline}
  services={study.data.services}
  publishDate={study.data.publishDate}
  nextResult={nextResult}
>
  <Content />
</ResultsLayout>
